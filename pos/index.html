<!DOCTYPE html>

<html>

<head>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

<link rel="stylesheet" href="../jquery.mobile-1.4.5/jquery.mobile-1.4.5.min.css">

<!-- <link rel="stylesheet" href="themes/mwcminiprojecttheme.min.css" /> -->
<!-- <link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" /> -->

<script src="../jquery-2.1.4.min.js"></script>
<script src="../jquery.mobile-1.4.5/jquery.mobile-1.4.5.min.js"></script>

<script type="text/javascript">
    var trans_id;
    var trans_val;
    var threshold = 500;

    $(document).ready(init_transaction());

    function init_transaction(){
      trans_id = "";
      //note to self: reset to 0;
      trans_val = 540;
    }

    function generate_transaction_id(){
      trans_id = "";
      var the_date = new Date();
      trans_id = the_date.getTime();
      trans_id += makeid();
    }

    function makeid(){
      var text = "";
      var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";
      for( var i=0; i < 2; i++ )
        text += possible.charAt(Math.floor(Math.random() * possible.length));
      return text;
    }

    $(function(){
        $("#scanbtn").click(function(){
          if(trans_id==""){
            generate_transaction_id();
          }
            // cordova.plugins.barcodeScanner.scan(
                // function (result) {
                    // getProduct(result.text);
                    getProduct("83012016");
                // },
                // function (error) {
                    // alert("Scanning failed: " + error);
                // }
            // );
        });

        $("#submitbtn").click(function(){
          //create transaction record: $transaction_id, $date, $time, $customer
          add_transaction();
          if (trans_val>=threshold){
            send_discount_code();
          }
          init_transaction();
        });
    });

    function send_discount_code() {
      var customer_val = $("#customer_phone").val();
      alert(customer_val);
      var theUrl="../action.php?cmd=3&customer="+customer_val;
    }

    function add_transaction() {
      var the_date = new Date();
      var date_val = the_date.getFullYear() + "-" + (the_date.getMonth()+1) + "-" + the_date.getDate();
      var time_val = the_date.getHours() + ":" + the_date.getMinutes() + ":" + the_date.getSeconds();
      var customer_val = $("#customer_phone").val();
      var total_val = trans_val;

      var theUrl="../action.php?cmd=2&transid="+trans_id+"&date="+date_val+"&time="+time_val+"&customer="
      +customer_val+"&value="+total_val;

      var obj=sendRequest(theUrl);		//send request to the above url
      if(obj.result==1){					//check result

      }else{
          //show error message
          alert("error adding");//err
      }

    }

    function sendRequest(u){
        // Send request to server
        //u a url as a string
        //async is type of request
        alert(u);
        var obj=$.ajax({url:u,async:false});
        //Convert the JSON string to object
        var result=$.parseJSON(obj.responseText);
        return result;	//return object
    }

    function getProduct(code){
      var theUrl="../action.php?cmd=1&productid="+code;
      var obj=sendRequest(theUrl);		//send request to the above url
      if(obj.result==1){					//check result
        var product_name = obj.product[0]['product_name'];
        var product_price = obj.product[0]['product_price'];
        $("#prod_name_display").html(product_name);
        $("#prod_id_display").html("Barcode: "+code);
        $("#prod_price_display").html("Price: GHc"+product_price);

        $("#simulateClick").trigger("click");
      }else{
          //show error message
          alert("error adding");//err
      }
    }
</script>


</head>

<body>
<div data-role="page" id="pageone" data-theme="a">

<div data-role="header">
<h1>Point of Sale</h1>

</div>

<div role="main" class="ui-content">

<!-- <a href="#popupSetQty" data-role=button data-inline=false id="scanbtn">Scan Product</a> -->

<a href="#popupSetQty" data-rel="popup" data-position-to="window"  id="simulateClick" data-transition="pop">

<a href="" id="scanbtn"
class="ui-btn ui-corner-all ui-shadow ui-icon-camera ui-btn-icon-left ui-btn-a"
>Scan Product</a>

<input type="tel" name="customer_phone" id="customer_phone" value="" placeholder="Phone Number" data-theme="a">

<div data-role="popup" id="popupSetQty" data-theme="a" class="ui-corner-all">
  <!-- <form> -->
    <div style="padding:10px 20px;">
      <h3 id="prod_name_display">Product Name</h3>
      <h4 id="prod_id_display">Code: Barcode</h4>
      <h4 id="prod_price_display">Price: GHc 0.00</h4>
      <h4>Please input the quantity</h4>
      <label for="quantity" class="ui-hidden-accessible">Quantity:</label>
      <input type="number" name="quantity" id="quantity" value="" placeholder="quantity" data-theme="a">
      <a href="" id="addtocartbtn" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-btn-icon-left ui-icon-shop" data-rel="back" role="button">Add to Cart</a>
    </div>
  <!-- </form> -->
</div>

<!--<a href="#pagetwo" data-role="button">Go To Other</a>-->

<ul data-role="listview" data-inset="true">
    <li>
      <img src="pos_icon.png">
    <h2>Broken Bells</h2>
    <p>Broken Bells</p></a>
  </li>
  <li>
    <img src="icon.png">
    <h2>Warning</h2>
    <p>Hot Chip</p></a>
  </li>
  <li>
    <img src="pos_icon.png">
    <h2>Wolfgang Amadeus Phoenix</h2>
    <p>Phoenix</p></a>
  </li>
</ul>

<div>
<h2 id="total_val" style="float:right;">Total: GHc 50.00</h2>
</div>
<br><br><br><br>
<a href="" data-rel="popup" data-position-to="window" id="submitbtn"
class="ui-btn ui-corner-all ui-shadow ui-icon-shop ui-btn-icon-left ui-btn-a"
data-transition="pop">Submit</a>

</div>


<div data-role="footer"> <h1>Made With Love in Berekuso</h1>
</div> </div>



</body> </html>
